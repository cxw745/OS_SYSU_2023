# 本科生实验报告

**姓名：陈雪玮**

**学号：21307387**

## 1.实验要求

1. **独立完成**实验5个部份**环境配置**、**编译Linux内核**、**Qemu启动内核并开启远程调试**、**制作Initramfs**和**编译并启动Busybox**。

2. 编写实验报告、结合实验过程来谈谈你完成实验的思路和结果，最后需要提供实验的5个部份的程序运行截屏来证明你完成了实验。

## 2.实验步骤/实验过程/实验结果

### 安装虚拟机并启动

这一步是启动虚拟机。

使用VirtualBox作为虚拟机的启动环境，操作系统为Ubuntu18.04。名称为snow，操作系统的用户名也为snow。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-09-35-11-image.png)

启动过程中出现了“不能为虚拟电脑打开一个新任务”的问题，解决方法是设置为每次都以管理员身份运行。

<img src="file:///C:/Users/Chan/AppData/Roaming/marktext/images/2023-03-03-14-30-32-image.png" title="" alt="" width="330">

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-09-38-20-image.png)

启动虚拟机后按照步骤安装即可。

### 环境配置

这一步是配置好下载环境和代码编译环境，以及为后面的步骤准备好工具集。

**用到的Linux命令**

sudo：以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自执行。

mv：（move file）用来为文件或目录改名、或将文件或目录移入其它位置。

apt：（Advanced Packaging Tool）是一个在 Debian 和 Ubuntu 中的 Shell 前端软件包管理器。提供了查找、安装、升级、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。命令执行需要超级管理员权限(root)，与sudo一起使用。

gedit：启动GNOME桌面环境下的文本编辑器gedit。

mkdir：（make directory）用于创建目录。

cd：（change directory）用于切换当前工作目录。另外，~ 也表示为 home 目录 的意思， . 则是表示目前所在的目录， .. 则表示目前目录位置的上一层目录。

tar：（tape archive ）命令用于备份文件。用来建立，还原备份文件的工具程序，它可以加入，解开备份文件内的文件。

cpio：cpio 是用来建立，还原备份档的工具程序，它可以加入，解开 cpio 或 tar 备份档内的文件。

**换源**

为了提高下载速度，将Ubuntu默认的国外下载源更换为国内的下载源。这里使用中国科技大学的镜像源。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-08-45-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-09-35-image.png)

换源成功

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-12-24-image.png)

**配置C/C++环境**

这一步骤是为了配置C/C++环境。先搞清楚一些名词是什么，以及为什么要安装这些工具。

GUN：GNU的全称是 “**GNU’s Not Unix!**”，是一个自由的操作系统，其内容软件完全以GPL方式发布。

GPL： 全称是 **GNU General Public License** ，被翻译为 **GNU通用公共许可协议**。

GCC：全称是 **GNU Compiler Collection**，是GUN计划制作的一种优化编译器。

binutils：**GNU Binutils**，是 GNU Binary Utilities 的简写，一般简称为 Binutils。**中文可以翻译为 GNU 的二进制工具集**。

binutils安装成功

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-10-02-06-image.png)

gcc安装成功

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-10-40-41-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-09-59-15-image.png)

**安装其他工具**

同样，我们先搞清楚这些工具是什么。

qemu：以GPL许可证分发源码的虚拟操作系统模拟器。开虚拟机用的。

cmake：跨平台的编译工具，能够输出各种各样的makefile或者project文件。

libncurses5-dev：图形函数库，作用是可以在终端内绘制简单的图形用户界面。

bison：属于 GNU 项目的一个语法分析器生成器。

flex：一个生成词法扫描器的工具。

libssl-dev：是OpenSSL通用库，OpenSSL是广泛使用的商业级SSL工具，SSL也即Secure Socket Layer，是由网景公司为了传输敏感数据而提出的协议。SSL使用私钥加密传输的数据，防止被窃听。

libc6-dev-i386：用于 i386 架构内核/系统的 libc 的 i386 版本。这是用于运行为 i386 系统构建的包。

gcc-multilib ：主要是用于**支持交叉编译**（cross compiling），即编译出来的程序是用来在其他处理器平台上运行的。

g++-multilib：交叉编译器。

nasm：NASM是一个汇编器的名称，全称是Netwide Assembler，支持x86与x64架构的CPU(注意不支持ARM架构)。

我们需要利用qemu启动编译好的i386内核，并且在上面创建我们的操作系统，而程序的编译过程是预处理、编译、汇编、链接，因此我们需要以上工具实现内核搭建和程序编译。

这些工具安装成功![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-10-42-36-image.png)![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-10-44-03-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-14-37-image.png)

vscode安装成功

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-10-46-36-image.png)

nasm-2.15安装成功

可以使用命令wget从网络上下载安装得到

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-15-23-image.png)

### 编译Linux内核

这一步是将下载来的Linux内核编译成i386 32位版本。

编译成功如下：

符号表linux-5.10.19/vmlinux

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-35-57-image.png)

压缩镜像linux-5.10.19/arch/x86/boot/bzImage

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-08-11-37-51-image.png)

### 启动内核并调试

这一步是用qemu启动编译好的i386内核，并通过gdb对其调试。

首先了解要用到的gdb是什么

 GDB 全称“GNU symbolic debugger”，一般来说，GDB主要帮助我们完成以下四个方面的功能：

1. 启动你的程序，可以按照你的自定义的要求随心所欲的运行程序。
2. 在某个指定的地方或条件下暂停程序。
3. 当程序被停住时，可以检查此时你的程序中所发生的事。
4. 在程序执行过程中修改程序中的变量或条件，将一个bug产生的影响修正从而测试其他bug。

我们这一步需要在qemu上启动我们的i386内核，并用gdb对其进行调试。

qemu虚拟机里运行的Linux系统能成功启动，并且最终以Kernel panic宣告结束。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-09-19-30-11-image.png)

### 制作Initramfs

这一步是为了解决上一步启动系统的时候只指定了bzImage，没有指定initrd文件，系统无法mount上initrd (init ram disk) 及其initramfs文件系统的问题。

首先了解一下Initramfs是什么

initramfs 即 initram file system，翻译成中文意思就是 **初始 ram 文件系统**，**在内核启动的早期提供用一个户态环境，用于完成在内核启动阶段不易完成的工作**。

制作好initramfs后，启动内核并且加载，再次启动gdb进行远程调试，可以看到gbd中输出了程序运行的结果。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-09-19-35-40-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-09-19-34-40-image.png)

### 编译并启动Busybox

busybox是一个开发工具箱，继承压缩了Linux的许多工具和命令，下面是实验结果。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-09-21-49-29-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-09-21-50-10-image.png)

## 3.关键操作/关键代码

无，这节主要是熟悉一些配置操作。

## 4.总结

实验中遇到很多不懂的名词，也不太明白这一步的具体步骤为什么要这样做。但是通过查询，最终也大致明白每一步是在做什么。简单来说，主要做的事情就是在Linux环境下通过qemu启动内核并且通过gdb实现了简单的调试，以及配置了必要的工具。

对实验的建议是，希望能在教学文档中增加多一些前置知识（各种名词和工具以及每一步的目的是什么）的解释。

## 5.参考

[百度百科_全球领先的中文百科全书 (baidu.com)](https://baike.baidu.com/)

[在VirtualBox中安装Ubuntu18.04教程_weixin_45841676的博客-CSDN博客](https://blog.csdn.net/weixin_45841676/article/details/106106246#:~:text=VirtualBox%E4%B8%AD%E5%AE%89%E8%A3%85Ubuntu%2018.04.1%20LTS%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8E%E9%85%8D%E7%BD%AE1.%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%94%B5%E8%84%912.%E5%90%AF%E5%8A%A8%E8%AE%BE%E7%BD%AE3.%E5%90%AF%E5%8A%A8%20%E5%AE%89%E8%A3%85%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE%20%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8E%E9%85%8D%E7%BD%AE%201.%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%94%B5%E8%84%91,%E6%89%93%E5%BC%80%20VirtualBox%20%EF%BC%8C%E5%B9%B6%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%94%B5%E8%84%91%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A%20%E4%B8%8B%E4%B8%80%E6%AD%A5%E8%AE%BE%E7%BD%AE%E5%86%85%E5%AD%98%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A%20%E4%B8%8B%E4%B8%80%E6%AD%A5%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%A1%AC%E7%9B%98%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A%20%E7%82%B9%E5%87%BB%E5%88%9B%E5%BB%BA%EF%BC%8C%E9%80%89%E6%8B%A9%E8%99%9A%E6%8B%9F%E7%A1%AC%E7%9B%98%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A%20%E8%BF%99%E9%87%8C%E9%80%89%E6%8B%A9VritualBox%E9%BB%98%E8%AE%A4%E7%9A%84VDI%E7%B1%BB%E5%9E%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E4%B8%8B)

[Linux 命令大全 | 菜鸟教程 (runoob.com)](https://www.runoob.com/linux/linux-command-manual.html)

[程序详细编译过程（预处理、编译、汇编、链接） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/476697014)

[GCC、GNU到底啥意思？_一只杨阳羊的博客-CSDN博客](https://blog.csdn.net/qq_43617936/article/details/104504992)

[GNU Binutils 介绍 - 会打架的程序员不是好客服 - 博客园 (cnblogs.com)](https://www.cnblogs.com/doggod/p/13354037.html)

[执行命令：sudo apt-get update时出错，仓库xx不再含有/没有Release文件，无法用该源更新【ubuntu21.04虚拟机】_futureCode.的博客-CSDN博客](https://blog.csdn.net/qq_44177918/article/details/129217984#:~:text=install%20E%3A%20%E8%BD%AF%E4%BB%B6%E5%8C%85%20%2A%20%E5%8F%AF%E5%AE%89%E8%A3%85%E5%80%99%E9%80%89%20--%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%20install%20E%3A,%E8%BF%99%E5%8F%AF%E8%83%BD%E6%84%8F%E5%91%B3%E7%9D%80%E8%BF%99%E4%B8%AA%E7%BC%BA%E5%A4%B1%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%8F%AF%E8%83%BD%E5%B7%B2%E8%A2%AB%E5%BA%9F%E5%BC%83%EF%BC%8C%20%E6%88%96%E8%80%85%E5%8F%AA%E8%83%BD%E5%9C%A8%E5%85%B6%E4%BB%96%E5%8F%91%E5%B8%83%E6%BA%90%E4%B8%AD%E6%89%BE%E5%88%B0%20E%3A%20%E8%BD%AF%E4%BB%B6%E5%8C%85%20vim%20%E8%BF%98%20%E5%8F%AF%E4%BE%9B%E5%AE%89%E8%A3%85%E7%9A%84%E5%80%99%E9%80%89%E8%80%85%20jiaote)

[Linux / Ubuntu上使用vscode编译运行和调试C/C++ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/80659895)

[Ubuntu18.04下安装VCode并配置C/C++调试环境_Liu-FE的博客-CSDN博客](https://blog.csdn.net/qq_45264808/article/details/109543259)

[initramfs 在内核中的作用与实现_initramfs是什么_江下枫的博客-CSDN博客](https://blog.csdn.net/song_lee/article/details/106027410)
