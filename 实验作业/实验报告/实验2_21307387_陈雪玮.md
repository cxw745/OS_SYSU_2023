# 本科生实验报告

**姓名：陈雪玮**

**学号：21307387**

## 1.实验要求

学习x86汇编、计算机的启动过程、IA-32处理器架构和字符显存原理。能自己编写程序，让计算机在启动后加载运行，增进对计算机启动过程的理解，为后面编写操作系统加载程序奠定基础。同时，也将学习使用gdb调试程序的基本方法。

完成思考题

14.字符弹射程序。

16.实模式中断。

17.汇编代码的编写。

## 2.实验过程和结果（包含关键代码）

### 复现mbr输出Hello Wrold

源代码在`mbr.asm`中。

不赋值为 `0xB8000` 是因为段地址需要左移 4 位后加上偏移地址得到实地址。

`物理地址=(段地址<<4)+偏移地址`

编写`mbr.asm`，然后依据步骤生成文件并运行。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-20-30-46-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-20-19-47-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-15-11-34-45-image.png)

### 14.字符弹射程序

源代码在`cs.asm`中

**实现思路**：定义状态、行动和决策。

状态：当前的坐标位置。

行动：右上、右下、左上、左下移动。

决策：如果当前的坐标到达了边缘，那么下一次就四十五度反弹；否则沿着前一行动前进。

根据以上定义，我利用10h中断来实现。以下是结果和关键代码。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-22-55-11-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-23-00-07-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-23-02-54-image.png)

### 16.实模式中断

**1.请探索实模式下的光标中断，利用中断实现光标的位置获取和光标的移动。说说你是怎么做的，并将结果截图。**

代码为`move.asm`

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-23-06-01-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-21-27-24-image.png)

利用光标位置的获取使用功能号`AH=03H`和光标的移动使用功能号`AH=02H`。

中断号使用`int 0x10`。

实现了获取了光标位置并且将其移动到第五行第五列，下面是结果截图和关键代码。

**光标的初始位置**

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-21-11-40-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-21-29-10-image.png)

**移动后**

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-21-32-22-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-21-31-59-image.png)

**2.请修改Hello World的代码，使用实模式下的中断来输出你的学号。说说你是怎么做的，并将结果截图。**

代码为`num.asm`

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-22-02-28-image.png)

利用功能码03H和09H，在`num.asm`中写入代码，并且按照前面的步骤运行。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-22-05-25-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-22-07-59-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-22-01-48-image.png)

**3.探索实模式的键盘中断，利用键盘中断实现键盘输入并回显。**

代码为`keby.asm`

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-16-22-38-25-image.png)

使用中断号0x16，和功能00就可以实现将键盘输入读取（阻塞），并将键盘读取到的ASCII码存储在ah寄存器中，而ah寄存器又是中断号0x09将会输出的内容，因此使用0x16读取键盘输入，0x09输出内容，0x02将光标移动到下一个位置即可实现**键盘输入并回显**的功能。

测试从键盘输入所有英文字母和我的电脑名以及学号。以下是结果和关键代码。

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-17-10-13-02-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-17-10-10-57-image.png)

### 17.汇编代码的编写

代码为`student.asm`

以下是结果截图和关键代码截图。

![loading-ag-278](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-11-42-04-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-23-15-33-image.png)

![](C:\Users\Chan\AppData\Roaming\marktext\images\2023-03-19-23-17-03-image.png)

## 3.总结

通过这次实验，我学习了x86汇编语言的使用，自己编写并在虚拟机上实现了程序的运行；也学习了计算机的启动过程、IA-32处理器架构和字符显存原理。通过实验任务的完成，我加深了对计算机启动过程的理解，对计算机硬件的理解。

在实验的过程中，遇到程序编写的问题，我能通过gdb调试查找错误并且修正；遇到陌生的内容，我通过指导书和互联网搜寻解决的方案。特别是汇编语言的学习中，遇到了寄存器地址和寄存器内容没有分清，导致读取错误的问题；也遇到寄存器赋值而类型不匹配的问题。这些问题让我认识到我在通过汇编语言直接控制着计算机硬件，需要严谨且细心地对待每一句汇编代码。通过实验我学习到了具体的知识，也增长了我解决问题的能力。

## 4.参考

[x86段寄存器和分段机制 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/324210723#:~:text=x86%E5%B0%86%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E5%88%92%E5%88%86%E5%BE%88%E5%A4%9A%E6%AE%B5%EF%BC%88%E6%89%80%E6%9C%89%E7%9A%84%E6%93%8D%E4%BD%9C%E9%83%BD%E6%98%AF%E5%9C%A8%E7%9C%9F%E5%AE%9E%E7%9A%84%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E4%B8%8A%EF%BC%8C%E5%BD%93%E6%97%B6%E6%B2%A1%E6%9C%89%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%99%E4%B9%88%E4%B8%80%E8%AF%B4%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E6%98%AF%E6%89%80%E8%B0%93%E7%9A%84%E5%AE%9E%E6%A8%A1%E5%BC%8F%EF%BC%89%EF%BC%8C%E6%AE%B5%E5%9F%BA%E5%9C%B0%E5%9D%80%E9%87%87%E7%94%A8%E4%B8%A4%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90,%2816%E7%9A%84%E5%80%8D%E6%95%B0%29%EF%BC%8C%E5%8D%B316%E4%BD%8D%E7%9A%84%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8%E5%8F%AA%E9%9C%80%E8%A6%81%E8%AE%B0%E5%BD%95%E5%9C%B0%E5%9D%80%E7%9A%84%E9%AB%9816%E4%BD%8D%EF%BC%8Cip%E5%AF%84%E5%AD%98%E5%99%A8%E8%AE%B0%E5%BD%95%E6%AE%B5%E5%86%85%E5%81%8F%E7%A7%BB%E9%87%8F%E3%80%82)

[BIOS - OSDev Wiki](https://wiki.osdev.org/BIOS)

[BIOS INT中断整理_bios int 调色板模式_rhxznp的博客-CSDN博客](https://blog.csdn.net/qq_28256699/article/details/121107900)

[键盘I/O中断调用（INT 16H）和常见的int 17H、int 1A H_deniece1的博客-CSDN博客](https://blog.csdn.net/deniece1/article/details/103447413)

[阻塞与非阻塞的区别 - 麦飞 - 博客园 (cnblogs.com)](https://www.cnblogs.com/orez88/articles/2513460.html)

[x86寄存器总结 - Frank__Chen - 博客园 (cnblogs.com)](https://www.cnblogs.com/FrankChen831X/p/10482718.html)

[记录一下 lab2 实操过程出现的问题及其解决办法 · Issue #2 · YatSenOS/YatSenOS-Tutorial-Volume-1 (github.com)](https://github.com/YatSenOS/YatSenOS-Tutorial-Volume-1/issues/2)

[assembly - 如何在汇编语言8086中设置1秒延时 - 堆栈内存溢出 (stackoom.com)](https://stackoom.com/question/11mip)

## 5.学习笔记

**如何在屏幕上显示**

在主引导扇区阶段， 0xB8000-0xBFFFF这段物理地址对应的内存是留给显卡的，每屏2000个字符，按顺序存放在这段空间里。所以我们想要在屏幕上输出，就要改写这段内存。

注意：不能用立即数给段寄存器赋值，所以需要使用ax累加寄存器帮助

一个字符两个字节

最后我们填充0x55，0xaa表示这512字节是MBR。

Linux中符号表的文件格式是ELF
